<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Untitled</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">body { line-height: 1.3em; }
p { line-height: 1.5em; }
img {
display: block;
margin-left: auto;
margin-right: auto;
width: 66%;
}
h1, h2, h3 {
padding: 1em 1em; border-left: 0.5em solid #000;
background: #f4f4f4;
}
h1.title {
all: initial;
font-size: 1em;
border-left: 3em solid #000;
padding: 0em 0.5em 0em 0.5em;
font-weight: bold;
}
p.author, h2.author {
all: initial;
font-size: 1em;
border-left: 0.5em solid #000;
padding: 0em 0.5em 0em 0.5em;
font-weight: bold;
}
p.date, h3.date {
all: initial;
font-size: 1em;
border-left: 0.5em solid #000;
border-right: 10em solid #000;
padding: 0em 0.5em 0em 0.5em;
font-weight: bold;
}
p.caption {
text-align: center;
font-weight: bold;
}
table {
width: 85%;
margin: auto;
border-collapse: collapse;
border-spacing: 4px;
}
pre {
width: 85%;
padding: 0.5em 1em;
margin: auto;
border:1px solid #333;
padding: 4px;
}
td, th {
border-collapse: collapse;
border:1px solid #333;
}
div.success {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #408040;
background-color: #e0FFe0;
}
div.warning {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #807060;
background-color: #FFF8E8;
}
div.danger {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #FF0000;
background-color: #FFE0E0;
}
div.info {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #404080;
background-color: #e8e8FF;
}
div.pageref {
padding: 0.5em 1em;
margin: 2em 0;
color: #232323;
background: #fff8e8;
border-left: solid 10px #ffc06e;
}
code {

padding: 0.2em 0.2em 0.2em 0.2em; background: #f0f0f0;
border: solid 1px #808080;
border-radius: 0.2em;
}
pre code {
background: #ffffff;
border: none;
}</style>
</head>
<body>
<nav id="TOC">
<ul>
<li><a href="#toconet_nwk_btx">ToCoNet_Nwk_bTx()</a><ul>
<li><a href="#explanation">Explanation</a><ul>
<li><a href="#about-the-address">About the address</a></li>
</ul></li>
<li><a href="#arguments">Arguments</a></li>
<li><a href="#returns">Returns</a></li>
<li><a href="#sample-code">Sample code</a></li>
</ul></li>
</ul>
</nav>
<h1 id="toconet_nwk_btx">ToCoNet_Nwk_bTx()</h1>
<h2 id="explanation">Explanation</h2>
<p>Requests the transmission of radio packets on the relay net.</p>
<div class="warning">
<p>For more information on delivery, see the description of the <a href="../structure/tstxdataapp-netto.html"><code>tsTxDataApp</code></a> structure.</p>
</div>
<h3 id="about-the-address">About the address</h3>
<p>You can choose between two delivery addresses.</p>
<div class="info">
<p>If <code>TOCONET_NWK_ADDR_NEIGHBOUR_ABOVE</code> is specified, it is directly transmitted to the neighboring parent or repeater, and the LQI between the child and the parent or repeater can be aggregated to determine which parent or repeater is closer to the child.</p>
<p>Note: The accuracy of the LQI and distance is not high, and it is only possible to distinguish between very close (within 1m) and other positions.</p>
</div>
<table>
<colgroup>
<col style="width: 18%"></col>
<col style="width: 81%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Dst address</th>
<th>Remark</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>TOCONET_NWK_ADDR_NEIGHBOUR_ABOVE</code></td>
<td>Direct transmission to a reachable parent or repeater (or all of them if there are more than one).</td>
</tr>
<tr class="even">
<td><code>TOCONET_NWK_ADDR_PARENT</code></td>
<td>The packet is delivered to the parent device. (Even if a repeater receives a packet, it cannot know the reception of the packet by <code>ToCoNet_vRxEvent()</code>)</td>
</tr>
</tbody>
</table>
<h2 id="arguments">Arguments</h2>
<table>
<colgroup>
<col style="width: 44%"></col>
<col style="width: 7%"></col>
<col style="width: 47%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Name</th>
<th>Remark</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="../structure/tstoconet_nwk_context.html"><code>tsToCoNet_Nwk_Context</code></a><code>*</code></td>
<td>pContextNwk</td>
<td>A structure that manages the internal information of the relay network.</td>
</tr>
<tr class="even">
<td><a href="../structure/tstxdataapp-netto.html"><code>tsTxDataApp</code></a><code>*</code></td>
<td>sTx</td>
<td>A structure containing the data to be sent.</td>
</tr>
</tbody>
</table>
<h2 id="returns">Returns</h2>
<table>
<thead>
<tr class="header">
<th>Type</th>
<th>Remark</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>bool_t</td>
<td><code>TRUE</code>: The request has been accepted.<code>FALSE</code>: not accepted.</td>
</tr>
</tbody>
</table>
<h2 id="sample-code">Sample code</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb1-1" title="1"><span class="dt">static</span> tsToCoNet_NwkLyTr_Config sNwkLayerTreeConfig;</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="dt">static</span> tsToCoNet_Nwk_Context* pContextNwk;</a>
<a class="sourceLine" id="cb1-3" title="3">...</a>
<a class="sourceLine" id="cb1-4" title="4">    } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1-5" title="5">        <span class="co">// </span></a>
<a class="sourceLine" id="cb1-6" title="6">        tsTxDataApp sTx;</a>
<a class="sourceLine" id="cb1-7" title="7">        memset(&amp;sTx, <span class="dv">0</span>, <span class="kw">sizeof</span>(sTx)); <span class="co">// Always clear 0 before you use it!</span></a>
<a class="sourceLine" id="cb1-8" title="8">        uint8 *q =  sTx.auData;</a>
<a class="sourceLine" id="cb1-9" title="9">    </a>
<a class="sourceLine" id="cb1-10" title="10">        sTx.u32SrcAddr = ToCoNet_u32GetSerial();</a>
<a class="sourceLine" id="cb1-11" title="11">    </a>
<a class="sourceLine" id="cb1-12" title="12">        <span class="cf">if</span> (IS_APPCONF_OPT_TO_ROUTER()) {</a>
<a class="sourceLine" id="cb1-13" title="13">            <span class="co">// Received once by the router in the application </span></a>
<a class="sourceLine" id="cb1-14" title="14">            <span class="co">//and redelivered from the router to the parent unit</span></a>
<a class="sourceLine" id="cb1-15" title="15">            sTx.u32DstAddr = TOCONET_NWK_ADDR_NEIGHBOUR_ABOVE;</a>
<a class="sourceLine" id="cb1-16" title="16">        } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1-17" title="17">            <span class="co">// The router does not receive the data in the </span></a>
<a class="sourceLine" id="cb1-18" title="18">            <span class="co">//application, but simply relays it</span></a>
<a class="sourceLine" id="cb1-19" title="19">            sTx.u32DstAddr = TOCONET_NWK_ADDR_PARENT;</a>
<a class="sourceLine" id="cb1-20" title="20">        }</a>
<a class="sourceLine" id="cb1-21" title="21">    </a>
<a class="sourceLine" id="cb1-22" title="22">        <span class="co">// construct the payload</span></a>
<a class="sourceLine" id="cb1-23" title="23">        S_OCTET(<span class="ch">&#39;T&#39;</span>);</a>
<a class="sourceLine" id="cb1-24" title="24">        S_OCTET(sAppData.sFlash.sData.u8id);</a>
<a class="sourceLine" id="cb1-25" title="25">        S_BE_WORD(sAppData.u16frame_count);     </a>
<a class="sourceLine" id="cb1-26" title="26">​</a>
<a class="sourceLine" id="cb1-27" title="27">        <span class="co">// Sensor-specific data</span></a>
<a class="sourceLine" id="cb1-28" title="28">        memcpy(q,pu8Data,u8Len);</a>
<a class="sourceLine" id="cb1-29" title="29">        q += u8Len;</a>
<a class="sourceLine" id="cb1-30" title="30">    </a>
<a class="sourceLine" id="cb1-31" title="31">        sTx.u8Cmd = <span class="dv">0</span>; <span class="co">// Takes a value of 0..7. Use this when you want to separate packet types.</span></a>
<a class="sourceLine" id="cb1-32" title="32">        sTx.u8Len = q - sTx.auData; <span class="co">// Payload size</span></a>
<a class="sourceLine" id="cb1-33" title="33">        sTx.u8CbId = sAppData.u16frame_count &amp; <span class="bn">0xFF</span>; <span class="co">// Number to be notified by TxEvent, not to the destination</span></a>
<a class="sourceLine" id="cb1-34" title="34">        sTx.u8Seq = sAppData.u16frame_count &amp; <span class="bn">0xFF</span>; <span class="co">// Sequence number (to be notified to destination)</span></a>
<a class="sourceLine" id="cb1-35" title="35">        sTx.u8Retry = sAppData.u8Retry;</a>
<a class="sourceLine" id="cb1-36" title="36">​</a>
<a class="sourceLine" id="cb1-37" title="37">        <span class="cf">if</span> (ToCoNet_Nwk_bTx(pNwk, &amp;sTx)) {</a>
<a class="sourceLine" id="cb1-38" title="38">            ToCoNet_Event_SetState(pEv, E_STATE_APP_WAIT_TX);</a>
<a class="sourceLine" id="cb1-39" title="39">        } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1-40" title="40">            <span class="co">// ... Failed (sleep process)</span></a>
<a class="sourceLine" id="cb1-41" title="41">            ToCoNet_Event_SetState(pEv, E_STATE_SLEEP);</a>
<a class="sourceLine" id="cb1-42" title="42">        }</a></code></pre></div>
</body>
</html>
