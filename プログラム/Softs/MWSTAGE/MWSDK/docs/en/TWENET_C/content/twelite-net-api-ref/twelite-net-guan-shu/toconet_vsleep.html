<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Untitled</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">body { line-height: 1.3em; }
p { line-height: 1.5em; }
img {
display: block;
margin-left: auto;
margin-right: auto;
width: 66%;
}
h1, h2, h3 {
padding: 1em 1em; border-left: 0.5em solid #000;
background: #f4f4f4;
}
h1.title {
all: initial;
font-size: 1em;
border-left: 3em solid #000;
padding: 0em 0.5em 0em 0.5em;
font-weight: bold;
}
p.author, h2.author {
all: initial;
font-size: 1em;
border-left: 0.5em solid #000;
padding: 0em 0.5em 0em 0.5em;
font-weight: bold;
}
p.date, h3.date {
all: initial;
font-size: 1em;
border-left: 0.5em solid #000;
border-right: 10em solid #000;
padding: 0em 0.5em 0em 0.5em;
font-weight: bold;
}
p.caption {
text-align: center;
font-weight: bold;
}
table {
width: 85%;
margin: auto;
border-collapse: collapse;
border-spacing: 4px;
}
pre {
width: 85%;
padding: 0.5em 1em;
margin: auto;
border:1px solid #333;
padding: 4px;
}
td, th {
border-collapse: collapse;
border:1px solid #333;
}
div.success {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #408040;
background-color: #e0FFe0;
}
div.warning {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #807060;
background-color: #FFF8E8;
}
div.danger {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #FF0000;
background-color: #FFE0E0;
}
div.info {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #404080;
background-color: #e8e8FF;
}
div.pageref {
padding: 0.5em 1em;
margin: 2em 0;
color: #232323;
background: #fff8e8;
border-left: solid 10px #ffc06e;
}
code {

padding: 0.2em 0.2em 0.2em 0.2em; background: #f0f0f0;
border: solid 1px #808080;
border-radius: 0.2em;
}
pre code {
background: #ffffff;
border: none;
}</style>
</head>
<body>
<nav id="TOC">
<ul>
<li><a href="#toconet_vsleep">ToCoNet_vSleep()</a><ul>
<li><a href="#explanation">Explanation</a></li>
<li><a href="#arguments">Arguments</a></li>
<li><a href="#returns">Returns</a></li>
<li><a href="#sample-code">Sample code</a></li>
</ul></li>
</ul>
</nav>
<h1 id="toconet_vsleep">ToCoNet_vSleep()</h1>
<h2 id="explanation">Explanation</h2>
<p>Sleep with <a href="../../hw-api-ref/perifuraru/waketimer.html">WakeTimer</a>.</p>
<h4 id="about-wake-up-interruptions">About wake-up interruptions</h4>
<p>It is also possible to set an interrupt source other than WakeTimer. It is set beforehand before calling this function.</p>
<h4 id="e_event_toconet_on_sleep-event">E_EVENT_TOCONET_ON_SLEEP event</h4>
<p>Just before sleep, <code>E_EVENT_TOCONET_ON_SLEEP</code> is passed to each <a href="../yzaibento/README.html">user-defined event processing function.</a></p>
<div class="warning">
<p>To prevent <code>ToCoNet_vSleep()</code> from being called recursively, the following code example handles <code>E_EVENT_NEW_STATE</code>.</p>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb1-1" title="1"><span class="dt">void</span> vMyProcessEv(...) {</a>
<a class="sourceLine" id="cb1-2" title="2">    ...</a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="cf">case</span> E_STATE_SLEEPING:　</a>
<a class="sourceLine" id="cb1-4" title="4">        <span class="cf">if</span> (eEvent == E_EVENT_NEW_STATE) { </a>
<a class="sourceLine" id="cb1-5" title="5">            ToCoNet_vSleep(…);</a>
<a class="sourceLine" id="cb1-6" title="6">        }</a>
<a class="sourceLine" id="cb1-7" title="7">        <span class="cf">break</span>;</a>
<a class="sourceLine" id="cb1-8" title="8">    ...</a>
<a class="sourceLine" id="cb1-9" title="9">}</a></code></pre></div>
<h4 id="about-sleep-time">About sleep time</h4>
<p>The WakeTimer works with the accuracy of a 32 kHz oscillator, so the accuracy of the oscillator is very important for the wake-up accuracy. The built-in oscillator must be calibrated before use (unless otherwise specified in <code>sToCoNet_AppContext</code>, in which case it will be executed in the TWENET library on cold start).</p>
<div class="warning">
<p>Extremely short sleep intervals cannot be set. The lower limit is approximately 30ms.</p>
<p>The wake-up time depends on the accuracy of the WakeTimer, but even in the best case there is an error of about ±0.1%.</p>
</div>
<h2 id="arguments">Arguments</h2>
<table>
<colgroup>
<col style="width: 1%"></col>
<col style="width: 3%"></col>
<col style="width: 95%"></col>
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Name</th>
<th>Remark</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>uint8</code></td>
<td><code>u8Device</code></td>
<td>Wake-up timer to be used.</td>
</tr>
<tr class="even">
<td><code>uint32</code></td>
<td><code>u32Periodms</code></td>
<td>Specifies the sleep period in ms.</td>
</tr>
<tr class="odd">
<td><code>bool_t</code></td>
<td><code>bPeriodic</code></td>
<td>Specifies whether periodic sleep should be performed. If cycle sleep is specified, the time elapsed since the last wake-up time is subtracted from the next wake-up time. If the next cycle has already passed, the sleep is performed for the specified period from the time of the call to this function, otherwise the sleep is performed for the specified period from the time of the call to this function.</td>
</tr>
<tr class="even">
<td><code>bool_t</code></td>
<td><code>bRamOff</code></td>
<td>If <code>FALSE</code>, sleep is performed with RAM retained. If <code>TRUE</code>, sleep is performed without retaining RAM.</td>
</tr>
</tbody>
</table>
<h2 id="returns">Returns</h2>
<p>None</p>
<h2 id="sample-code">Sample code</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><a class="sourceLine" id="cb2-1" title="1"><span class="co">// set UART Rx port as interrupt source</span></a>
<a class="sourceLine" id="cb2-2" title="2">vAHI_DioSetDirection(u32DioPortWakeUp, <span class="dv">0</span>); <span class="co">// set as input</span></a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">// set DIO wakeup source</span></a>
<a class="sourceLine" id="cb2-5" title="5">(<span class="dt">void</span>)u32AHI_DioInterruptStatus(); <span class="co">// clear interrupt register</span></a>
<a class="sourceLine" id="cb2-6" title="6">vAHI_DioWakeEnable(u32DioPortWakeUp, <span class="dv">0</span>); <span class="co">// enable ports</span></a>
<a class="sourceLine" id="cb2-7" title="7">vAHI_DioWakeEdge(u32DioPortWakeUp, <span class="dv">0</span>); <span class="co">// set edge (rising)</span></a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">// 10sec</span></a>
<a class="sourceLine" id="cb2-10" title="10">ToCoNet_vSleep(E_AHI_WAKE_TIMER_0, <span class="dv">10000</span>, FALSE, FALSE); </a></code></pre></div>
</body>
</html>
