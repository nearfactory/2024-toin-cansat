<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang xml:lang>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Mono Wireless Inc." />
  <title>&lt;PAL_NOTICE&gt;</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">body { line-height: 1.3em; }
p { line-height: 1.5em; }
img {
display: block;
margin-left: auto;
margin-right: auto;
width: 66%;
}
h1, h2, h3 {
padding: 1em 1em; border-left: 0.5em solid #000;
background: #f4f4f4;
}
h1.title {
all: initial;
font-size: 1em;
border-left: 3em solid #000;
padding: 0em 0.5em 0em 0.5em;
font-weight: bold;
}
p.author, h2.author {
all: initial;
font-size: 1em;
border-left: 0.5em solid #000;
padding: 0em 0.5em 0em 0.5em;
font-weight: bold;
}
p.date, h3.date {
all: initial;
font-size: 1em;
border-left: 0.5em solid #000;
border-right: 10em solid #000;
padding: 0em 0.5em 0em 0.5em;
font-weight: bold;
}
p.caption {
text-align: center;
font-weight: bold;
}
table {
width: 85%;
margin: auto;
border-collapse: collapse;
border-spacing: 4px;
}
pre {
width: 85%;
padding: 0.5em 1em;
margin: auto;
border:1px solid #333;
padding: 4px;
}
td, th {
border-collapse: collapse;
border:1px solid #333;
}
div.success {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #408040;
background-color: #e0FFe0;
}
div.warning {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #807060;
background-color: #FFF8E8;
}
div.danger {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #FF0000;
background-color: #FFE0E0;
}
div.info {
width: 90%;
margin: 0.5em 1em;
margin-left: auto;
margin-right: auto;
padding: 0.5em 1em;
border: dashed 2px #404080;
background-color: #e8e8FF;
}
div.pageref {
padding: 0.5em 1em;
margin: 2em 0;
color: #232323;
background: #fff8e8;
border-left: solid 10px #ffc06e;
}
code {

padding: 0.2em 0.2em 0.2em 0.2em; background: #f0f0f0;
border: solid 1px #808080;
border-radius: 0.2em;
}
pre code {
background: #ffffff;
border: none;
}</style>
</head>
<body>
<header id="title-block-header">
<h1 class="title">&lt;PAL_NOTICE&gt;</h1>
<p class="author">Mono Wireless Inc.</p>
</header>
<nav id="TOC">
<ul>
<li><a href="#pal_notice">&lt;PAL_NOTICE&gt;</a><ul>
<li><a href="#member-object">member object</a><ul>
<li><a href="#sns_pca9632">sns_PCA9632</a></li>
<li><a href="#sns_mc3630">sns_MC3630</a></li>
</ul></li>
<li><a href="#pca9632-definition">PCA9632-definition</a><ul>
<li><a href="#lighting-status">Lighting Status</a></li>
<li><a href="#led-identification-sub">LED identification sub</a></li>
<li><a href="#register-setting-definition">Register Setting Definition</a></li>
</ul></li>
<li><a href="#pca9632-operating-method">PCA9632-operating method</a><ul>
<li><a href="#master-switch">Master Switch</a></li>
<li><a href="#change-of-lighting-status">Change of lighting status</a></li>
<li><a href="#light-illumination-control">Light illumination control</a></li>
<li><a href="#blinking-control">Blinking Control</a></li>
<li><a href="#test-lighting">Test lighting</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<h1 id="pal_notice">&lt;PAL_NOTICE&gt;</h1>
<p>Board BEHAVIOR for <a target=_blank href="https://mono-wireless.com/jp/products/twelite-pal/sense/notice-pal.html">NOTICE PAL</a>.</p>
<p>In addition to <a href="README.html">common definition</a> plus the ability to handle sensors on the board.</p>
<ul>
<li>LED driver PCA9632</li>
<li>Accelerometer MC3630</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb1-1" title="1"><span class="dt">void</span> setup() {</a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="kw">auto</span>&amp;&amp; brd = the_twelite.board.use&lt;PAL_NOTICE&gt;();</a>
<a class="sourceLine" id="cb1-3" title="3">}</a></code></pre></div>
<h2 id="member-object">member object</h2>
<h3 id="sns_pca9632">sns_PCA9632</h3>
<p><a href="...%20/...%20/sensor_object/pca9632-leddoraiba.html">PCA9632 device</a> object. The board definition performs Wire initialization and device initialization. In principle, it is controlled using the PCA9632 operation method described below.</p>
<div class="warning">
<p>It is not possible to continuously draw a large current from a CR2032 coin cell. In this board definition, the maximum illuminance setting in normal operation is set at a PWM duty ratio of approximately 50%, but even at this setting, overload effects may be apparent. Adjust the combination of LEDs, illumination intensity, and blinking according to the operating requirements.</p>
</div>
<div class="info">
<p>When using coin cell batteries, periodic, momentary flashing can mitigate the effects of large currents.</p>
<p>For example, a setting that allows the LED to flash for 20 ms every second or so will not only maintain sufficient visual brightness to mitigate the above effects, but will also reduce battery drain. ) {endhint %}</p>
<h3 id="sns_mc3630">sns_MC3630</h3>
<p><a href="../../sensor_object/mc3630.html">MC3630 sensor</a> object. The board definition includes SPI initialization, MC3630 device initialization, and MC3630 interrupt processing. Various processes are handled by <a href="../../sensor_object/mc3630.html"><code>sns_MC3630</code></a>.</p>
<h2 id="pca9632-definition">PCA9632-definition</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb2-1" title="1"><span class="at">static</span> <span class="at">const</span> <span class="dt">uint8_t</span> LED_OFF = SnsPCA9632::LED_OFF;</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="at">static</span> <span class="at">const</span> <span class="dt">uint8_t</span> LED_ON = SnsPCA9632::LED_PWM;</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="at">static</span> <span class="at">const</span> <span class="dt">uint8_t</span> LED_BLINK = SnsPCA9632::LED_BLINK;</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="at">static</span> <span class="at">const</span> <span class="dt">uint8_t</span> LED_NOP = SnsPCA9632::LED_NOP;</a>
<a class="sourceLine" id="cb2-5" title="5"></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="at">static</span> <span class="at">const</span> <span class="dt">uint8_t</span> LED_R = SnsPCA9632::LED1;</a>
<a class="sourceLine" id="cb2-7" title="7"><span class="at">static</span> <span class="at">const</span> <span class="dt">uint8_t</span> LED_G = SnsPCA9632::LED2;</a>
<a class="sourceLine" id="cb2-8" title="8"><span class="at">static</span> <span class="at">const</span> <span class="dt">uint8_t</span> LED_B = SnsPCA9632::LED3;</a>
<a class="sourceLine" id="cb2-9" title="9"><span class="at">static</span> <span class="at">const</span> <span class="dt">uint8_t</span> LED_W = SnsPCA9632::LED4;</a>
<a class="sourceLine" id="cb2-10" title="10"></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="at">static</span> <span class="at">const</span> <span class="dt">uint8_t</span> LED_REG_MAX_PWM = <span class="dv">127</span>;</a>
<a class="sourceLine" id="cb2-12" title="12"><span class="at">static</span> <span class="at">const</span> <span class="dt">uint8_t</span> LED_REG_BOOST_PWM = <span class="dv">255</span>;</a></code></pre></div>
<h3 id="lighting-status">Lighting Status</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Definition</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>PAL_NOTICE::LED_OFF</code></td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>PAL_NOTICE::LED_ON</code></td>
<td style="text-align: left;">On (PWM illuminance control)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>PAL_NOTICE::LED_BLINK</code></td>
<td style="text-align: left;">Blinking</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>PAL_NOTICE::LED_NOP</code></td>
<td style="text-align: left;">Do not change</td>
</tr>
</tbody>
</table>
<h3 id="led-identification-sub">LED identification sub</h3>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Definition</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>PAL_NOTICE::LED_R</code></td>
<td style="text-align: left;">LED Red</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>PAL_NOTICE::LED_G</code></td>
<td style="text-align: left;">LED Green</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>PAL_NOTICE::LED_B</code></td>
<td style="text-align: left;">LED Green</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>PAL_NOTICE::LED_W</code></td>
<td style="text-align: left;">LED White</td>
</tr>
</tbody>
</table>
<h3 id="register-setting-definition">Register Setting Definition</h3>
<table>
<colgroup>
<col style="width: 50%"></col>
<col style="width: 50%"></col>
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Definition</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>PAL_NOTICE::LED_REG_MAX_PWM</code></td>
<td style="text-align: left;">PMW register set value for standard illuminance (1/2 of all lights are standard)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>PAL_NOTICE::LED_REG_BOOST_PWM</code></td>
<td style="text-align: left;">PWM register set value for boosting</td>
</tr>
</tbody>
</table>
<h2 id="pca9632-operating-method">PCA9632-operating method</h2>
<h3 id="master-switch">Master Switch</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb3-1" title="1"><span class="dt">void</span> set_led_master_sw_on() { digitalWrite(PIN_SNS_EN, LOW); }</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="dt">void</span> set_led_master_sw_off() { digitalWrite(PIN_SNS_EN, HIGH); }</a></code></pre></div>
<p>NOTICE PAL has a FET switch at the rear of the PCA9632 output. The LED will not light unless this switch is turned ON.</p>
<h3 id="change-of-lighting-status">Change of lighting status</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb4-1" title="1"><span class="dt">void</span> set_led_r_blink()</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="dt">void</span> set_led_r_on()</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="dt">void</span> set_led_r_off()</a>
<a class="sourceLine" id="cb4-4" title="4"><span class="dt">void</span> set_led_g_on()</a>
<a class="sourceLine" id="cb4-5" title="5"><span class="dt">void</span> set_led_g_blink()</a>
<a class="sourceLine" id="cb4-6" title="6"><span class="dt">void</span> set_led_g_off()</a>
<a class="sourceLine" id="cb4-7" title="7"><span class="dt">void</span> set_led_b_on()</a>
<a class="sourceLine" id="cb4-8" title="8"><span class="dt">void</span> set_led_b_blink()</a>
<a class="sourceLine" id="cb4-9" title="9"><span class="dt">void</span> set_led_b_off()</a>
<a class="sourceLine" id="cb4-10" title="10"><span class="dt">void</span> set_led_w_on()</a>
<a class="sourceLine" id="cb4-11" title="11"><span class="dt">void</span> set_led_w_blink()</a>
<a class="sourceLine" id="cb4-12" title="12"><span class="dt">void</span> set_led_w_off()</a></code></pre></div>
<p>Set individual LEDs to off, on, or blinking.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb5-1" title="1"><span class="dt">void</span> set_leds(<span class="dt">uint8_t</span> r, <span class="dt">uint8_t</span> g, <span class="dt">uint8_t</span> b, <span class="dt">uint8_t</span> w)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="dt">void</span> set_leds_off()</a></code></pre></div>
<p>set_leds() changes the lighting status of all LEDs. Parameters are <a href="pal_notice.html#%22dian-deng-zhuang-tai">lighting state</a><code>PAL_NOTICE::LED_OFF</code> <code>PAL_NOTICE::LED_ON</code> <code>PAL_NOTICE::LED_BLINK</code> <code>PAL_NOTICE::LED_NOP</code>.</p>
<h3 id="light-illumination-control">Light illumination control</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb6-1" title="1"><span class="dt">void</span> set_led_brightness_r_reg(<span class="dt">uint8_t</span> duty)</a>
<a class="sourceLine" id="cb6-2" title="2"><span class="dt">void</span> set_led_brightness_g_reg(<span class="dt">uint8_t</span> duty)</a>
<a class="sourceLine" id="cb6-3" title="3"><span class="dt">void</span> set_led_brightness_b_reg(<span class="dt">uint8_t</span> duty)</a>
<a class="sourceLine" id="cb6-4" title="4"><span class="dt">void</span> set_led_brightness_w_reg(<span class="dt">uint8_t</span> duty)</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="dt">void</span> set_leds_brightness_reg(<span class="dt">uint8_t</span> r, <span class="dt">uint8_t</span> g, <span class="dt">uint8_t</span> b, <span class="dt">uint8_t</span> w)</a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="dt">void</span> set_led_brightness_r1000(<span class="dt">uint16_t</span> duty, <span class="dt">bool</span> boost = <span class="kw">false</span>)</a>
<a class="sourceLine" id="cb6-8" title="8"><span class="dt">void</span> set_led_brightness_g1000(<span class="dt">uint16_t</span> duty, <span class="dt">bool</span> boost = <span class="kw">false</span>)</a>
<a class="sourceLine" id="cb6-9" title="9"><span class="dt">void</span> set_led_brightness_b1000(<span class="dt">uint16_t</span> duty, <span class="dt">bool</span> boost = <span class="kw">false</span>)</a>
<a class="sourceLine" id="cb6-10" title="10"><span class="dt">void</span> set_led_brightness_w1000(<span class="dt">uint16_t</span> duty, <span class="dt">bool</span> boost = <span class="kw">false</span>)</a>
<a class="sourceLine" id="cb6-11" title="11"><span class="dt">void</span> set_leds_brightness1000(</a>
<a class="sourceLine" id="cb6-12" title="12">    <span class="dt">uint16_t</span> r, <span class="dt">uint16_t</span> g, <span class="dt">uint16_t</span> b, <span class="dt">uint16_t</span> w, <span class="dt">bool</span> boost = <span class="kw">false</span>)</a></code></pre></div>
<p>Specifies the PWM duty ratio (LED lighting brightness).</p>
<p><code>set_led_brightness_? _reg()</code> and <code>set_leds_brightness_reg()</code> specify the register value directly. 0…255 is specified and the lighting will be the ratio <code>duty/256</code>.</p>
<p><code>set_led_brightness_?1000()</code> and <code>set_leds_brightness1000()</code> specify a duty ratio of 0..1000, where 0 corresponds to no light and the larger the value, the brighter (longer lighting interval). If <code>boost</code> is set to <code>false</code>, the register value is 127 when 1000 is specified. If <code>boost</code> is set to <code>true</code>, the register value will be 255.</p>
<div class="warning">
<p>Since PAL is operated by a coin cell battery, the specified maximum value is set to a duty ratio of approximately 50%.</p>
</div>
<div class="warning">
<p>The final setting is assigned to the register value, so even if 0…1000 steps are specified, the actual control value will be the precision of the register value.</p>
</div>
<h3 id="blinking-control">Blinking Control</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb7-1" title="1"><span class="dt">void</span> set_blink_cycle_ms(<span class="dt">uint16_t</span> x)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="dt">void</span> set_blink_duty1000(<span class="dt">uint16_t</span> x)</a></code></pre></div>
<p>LEDs with <code>PAL_NOTICE::LED_BLINK</code> will blink with the specified period and lighting duration ratio.</p>
<ul>
<li>Blinking patterns cannot be specified individually.</li>
<li>Brightness can also be controlled since the LEDs are turned on at the PWM duty ratio specified in the lighting illuminance setting above.</li>
</ul>
<p><code>set_blink_cycle_ms()</code> blinks for a period of time specified by <code>x</code>.</p>
<p>set_blink_duty1000()<code>sets</code>x<code>to 0..1000 and blinks for</code>cycle*x/1000` as the lighting period.</p>
<div class="warning">
<p>The final setting is assigned to the register value, so even if you specify 0…1000 steps, the actual control value will be the precision of the register value.</p>
</div>
<h3 id="test-lighting">Test lighting</h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><a class="sourceLine" id="cb8-1" title="1"><span class="dt">void</span> test_led()</a></code></pre></div>
<p>Turns on the 4 LEDs for a very short period of time. After lighting, the master switch is turned on (<code>set_led_master_sw_on()</code>).</p>
</body>
</html>
